entities:
  seaf.app.services:
    presentations:
      blank:
        title: Сводка по прикладному сервису
        params:
          type: object
          properties:
            seaf-app-service-id:
              title: Идентификатор прикладного сервиса
              type: string
          required:
            - seaf-app-service-id
        widgets:
          summary:
            title: Сводка по прикладному сервису
            presentation: summary
            align: "<"
            order: 10
            style:
              margin: 4px
              border: true
          components:
            title: Состоит из компонент
            presentation: components
            align: ">"
            order: 10
            style:
              margin: 4px
              border: true
        type: mkr-grid
        source: >
          (
              $service_id := $params."seaf-app-service-id";
              $widgets := $.entities."seaf.app.services".presentations.blank.widgets;
              $wleft := $widgets.*[align="<"]^(order);
              $wright := $widgets.*[align=">"]^(order);
              $wcenter := $widgets.*[$not(align=">" or align="<")]^(order);
          
              $makeWidget := function($widgets) {(
                  [$widgets.{
                      "title": title,
                      "icon": icon,
                      "style": style ? style : {},
                      "src": "@entity/seaf.app.services/" & presentation & "?seaf-app-service-id=" & $service_id
                   }];
              )};
          
              /* Строим разметку страницы */
              {
                "type": "rows",
                "items": $append(
                  [
                    {
                      "type": "columns",
                      "items": [
                        {
                          "type": "rows",
                          "width": "40%",
                          /* Строим список виджетов левой секции */
                          "items": $makeWidget($wleft)
                        },
                        {
                          "type": "rows",
                          "width": "60%",
                          /* Строим список виджетов правой секции */
                          "items": $makeWidget($wright)
                        }
                      ]
                    }
                  ],
                  /* Добавляем центральные виджеты */
                  $makeWidget($wcenter)
                )
              }
          )